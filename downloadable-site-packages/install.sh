#!/bin/bash

rm -rf pure-python
mkdir pure-python

cd pure-python

curl -L https://files.pythonhosted.org/packages/e1/2d/4632afb17d93ced97d93858a0505090e717d5934828c3c1f0911e7bdd162/opencv_python-4.3.0.36-cp37-cp37m-macosx_10_9_x86_64.whl -O
mv *.whl opencv.zip
unzip opencv.zip
rm -rf opencv.zip
rm -rf cv2/qt
rm cv2/__init__.py
cp ../cv2/__init__.py cv2

curl -L https://files.pythonhosted.org/packages/33/73/fc8c85104bd316086a7717d4970aec5e05fafcd6b9bf7257fe3621b180a0/cryptography-2.7-cp37-cp37m-win_amd64.whl -O
mv *.whl cryptography.zip
unzip cryptography.zip
rm cryptography.zip

cd ../

python3.10 -m pip install --no-deps -r *requirements.txt -t pure-python
mv pure-python/*.dist-info ../site-packages

cd pure-python
rm -rf bin

find . -name "*.so" -delete
find . -name ".dylibs" -exec rm -rf {} \;
find . -name "*.dylib" -exec rm -rf {} \;

for f in *; do
rm -rf "../compiled/$f"
../../Extensions/Dependencies/tools/copy-scripts.sh "$f" "../compiled/$f"
done


find ../compiled/ -name "__pycache__" -exec rm -rf {} \;
find ../compiled/boto3 -name "*.rst" -delete
